---
[English](https://github.com/b10101101/twsearch/blob/win_compile/README_FORK_EN.MD)

[Русский](https://github.com/b10101101/twsearch/blob/win_compile/README_FORK_RU.MD)

---

# Информация об этом форке

Целью данного форка являлось прежде всего получение файла симулятора twsearch, работающего в Windows. Вторая задача состояла в том чтобы получить связку из 2 симуляторов: 

- [`twsearch`](https://github.com/cubing/twsearch)   
- [`Geraniums Pot`](https://github.com/grigorusha/GeraniumsPot)

## Немного сведений о Geraniums Pot

Geraniums Pot является симулятором головоломок класса "Пересекающиеся круги" и симулирует практически все существующие на данный момент головоломки такого рода. Описание головоломок а так же последовательность ходов осуществляется в оригинальной авторской нотации и задается в виде текстового файла. 

Типичное описание конфигурации

```
# ring number, center coordinates x y, radius, angle
Ring: 1,  0, 0, 50, 90
Ring: 2, 50, 0, 38.3, 45
```

То есть здесь описаны 2 круга (с номерами 1 и 2), координатами центров (0,0 и 50,0), заданы радиусы (50 и 38.3) и минимальные углы поворота (90 и 45) соответственно. 

Ходы и последовательности ходов в данной головоломке записываются в следующей нотации:

```
(1R1, 2L1, 1L3, 2R2),3
```

где:

`1R1` - поворот круга 1 по часовой стрелке на 1 минимальный угол.

`2L1` - поворот круга 2 против часовой стрелки на 1 минимальный угол.

`1L3` - поворот круга 1 против часовой стрелки на 3 минимальных угла.

`2R2` - поворот круга 2 по часовой стрелке на 2 минимальных угла.

`(...),3` - после скобок следует количество повторов последовательности.

Отмечу, что эмулятор может обрабатывать макросы, представляющие собой записанные пользователем последовательности ходов. При работе в связке нужно было преобразовать последовательности ходов, полученные на выходе [`twsearch`](https://github.com/cubing/twsearch) в нотацию симулятора [`Geraniums Pot`](https://github.com/grigorusha/GeraniumsPot)

## Пример работы с головоломкой

Рассмотрим существующую говоломку Arecibo. В эмуляторе twsearch есть её готовое описание [`Arecibo`](https://github.com/cubing/twsearch/blob/main/samples/main/arecibo.tws) и для нее описаны следующие возможные ходы:

```
Move L
 ........
End

MoveSequence R Fv L Fv

Move Fv
 .... flip all elements ....
End
```

И в процессе поиска алгоритмов мы получаем что-то вроде

```
(L R L R' L' R' L' R)45
(L R L R L R' L' R L' R' L' R' L R')30
```

В Geraniums Pot Arecibo описывается так

```
# ring number, center coordinates x y, radius, angle
Ring: 1, 50, 50, 50, 120 # левый круг
Ring: 2, 91, 50, 50, 120 # правый круг
```

Таким образом, для того чтобы ввести формулу в Geraniums Pot нужно преобразовать их до вида:

```
(L  R  L  R' L' R' L' R)45 соответствует
(1R,2R,1R,2L,1L,2L,1L,2R),45

(L  R  L  R  L  R' L' R  L' R' L' R' L  R')30 соответствует
(1R,2R,1R,2R,1R,2L,1L,2R,1L,2L,1L,2L,1R,2L),30
```

Не исключено что я ошибся составляя это преобразование, так как здесь легко ошибиться. Поэтому я нашел для себя другое решение.

Составляю описание в twsearch и применяю для описания такие ходы:

```
Solved
 ........ 
End

MoveAlias 1L 1R'
MoveAlias 2L 2R'

Move 1R
 ........
End

Move 2R
 ........
End
```

Таким образом я сразу оформляю ходы ближе к нотации Geraniums Pot и получаю на выходе что-то такое: `2R 1R 2R2' 1R 2R2 1R2' 2R' 1R2 2R' 1R' 2R 1R'` но и это тоже достаточно неудобно, нужно расставить запятые и в данном случае обратный ход `2R' `соответствует ходу `2L`. Мне нужно избавиться от обратных ходов. Поэтому я добавил в обработку файла формата .tws дополнительную команду `ReplaceMoves `которая позволяет заменить "неудобные" для нотации ходы:

```
Solved
 ........ 
End

MoveAlias 1L 1R'
MoveAlias 2L 2R'
MoveAlias 3L 3R'

MoveSequence PP 2L 1R 2R 1L 2L 1R 2R 1L 2L 1R 2R 1L 
ReplaceMoves PP  (2L,1R,2R,1L),3
ReplaceMoves PP' (1R,2L,1L,2R),3

ReplaceMoves R' L
ReplaceMoves L' R
ReplaceMoves R2' L2
ReplaceMoves L2' R2
ReplaceMoves R3' L3
ReplaceMoves L3' R3
```

## Что реализовано

- Добавлен makefile файл Makefiles/cpp_win.Makefile Это позволяет скомпилировать ТОЛЬКО twsearch.exe для Windows. Способ, предложенный автором:
  
  ```
  cl /o twsearch.exe /EHsc src\cpp\*.cpp src\cpp\cityhash\src\city.cc
  ```
  
  Это у меня не сработало, поэтому я сделал свой Makefile. Он позволяет получить twsearch.exe работающий в многопоточном режиме Windows  (`опция -t`) Для компиляции наберите:
  
  ```
  mingw32-make -f ./Makefiles/cpp_win.Makefile
  ```
  
   или запустите файл`compile_for_win64.bat`
  
  *Примечание: в данном контексте я не предусматриваю реализацию а Rust!*

- Для вывода результатов поиска решений и алгоритмов в нотации Geraniums Pot добавлена опция `--gp` Эта опция заменяет пробелы на запятую в алгоритмах с классической нотацией
  
  ```
  (1R 2L' 3R2)45 преобразуется в (1R,2L',3R2),45
  (1R3 2R' 1L 2L')7 преобразуется в (1R3,2R',1L,2L'),7
  ```
  
  *Примечание: эта опция работает только при выводе обычных последовательностей  (без скобок или с круглыми скобками), в "коммутаторной" нотации (`опция -A3`) запятая используется по другому назначению, поэтому данный способ там не реализуется*

- Замена обратных ходов командой `ReplaceMoves` Пример применения команды:
  
  ```
  ReplaceMoves A B  
  → fromMove = "A", toMove = "B"
  
  ReplaceMoves U (1R2, 3L4, 5R1),3
  → fromMove = "U", toMove = "(1R2, 3L4, 5R1),3"
  
  ReplaceMoves F2 F F  
  → fromMove = "F2", toMove = "F F"
  
  ReplaceMoves SomeMove Another Move, with comma
  → fromMove = "SomeMove", toMove = "Another Move, with comma"
  ```
  
  *Важно понимать что команда ReplaceMoves никак не учавствует в процессе поиска решений или алгоритмов. Её действие распространяется ТОЛЬКО на выводимый текст*
  
  Применим эту команду на практике
  
  ```
  ReplaceMoves 2L' 2R
  ReplaceMoves 2R' 2L
  ```
  
  в результате мы получим
  
  ```
  (1R 2L' 3R2)45 будет преобразовано в (1R 2R 3R2)45
  (1R3 2R' 1L 2L')7 будет преобразовано в (1R3 2L 1L 2R)7
  
  а при добавлении опции --gp
  (1R 2L' 3R2)45 будет преобразовано в (1R,2R,3R2),45
  (1R3 2R' 1L 2L')7 будет преобразовано в (1R3,2L,1L,2R),7
  ```
  
  <u>После такого преобразования можно полученный алгоритм выделить как текст и в симуляторе Geraniums Pot вставить его, нажав кнопку Ins или Ctrl+V</u>

## Как тестировалось

- для изучения работы программы и поиска новых алгоритмов я сделал тестовую головоломку, подобную [Trio ](https://twistypuzzles.com/app/museum/museum_showitem.php?pkey=1462), но с ориентацией ребер и треугольников. Находится в папке` /test/trio_orientir.tws`  А так же тестовый скрамбл для этой головоломки с примером поворота треугольников` /test/trio.scr` Можно запустить тест, кликнув файл `test.bat`
  
  Для визуализации процессов можно загрузить в Geraniums Pot  файл тестовой головоломки `/test/Trio_orientir.txt`
  
  *Обратите внимание! В описании этой головоломки есть последовательность PP* 

```
MoveSequence PP 2L 1R 2R 1L 2L 1R 2R 1L 2L 1R 2R 1L
```

  *Это полезный ход, который я часто использую при поиске алгоритмов и он аналогичен ходу (R U R' U')3 в обычном кубике Рубика, где меняет попарно положение 4 угловых элементов, не изменяя положения ребер. В головоломке Trio и подобных можно так же использовать его. Это даст чистый попарный обмен 4 треугольников с поворотами. Использование аналогичных последовательностей даёт прирост в скорости поиска решений, но увеличивает количество ходов получаемого решения*

## Инсталляция в среде Windows:

1. Для компиляции программы в Windows я использовал MinGW-w64 который можно скачать:
- с официальной страницы https://www.mingw-w64.org/ 

- или, в моем случае, я воспользовался готовой автономной сборкой https://github.com/brechtsanders/winlibs_mingw
2. Скачайте версию, соответствующую вашим требованиям. Я скачал и установил на мою систему Windows 8 Pro 64bit архив https://github.com/brechtsanders/winlibs_mingw/releases/download/15.2.0posix-13.0.0-msvcrt-r1/winlibs-x86_64-posix-seh-gcc-15.2.0-mingw-w64msvcrt-13.0.0-r1.7z.

3. Распакуйте его в рабочую папку c:\mingw64\

4. Далее необходимо добавить путь к этой папке в переменную PATH:
- Нажмите Win + R, введите sysdm.cpl. "Переменные среды" → "Системные переменныe" найдите Path

- Нажмите "Изменить" → "Создать" → Добавьте путь к папке bin вашего MinGW: C:\mingw64\bin
5. Скачайте и распакуйте https://github.com/b10101101/twsearch/ Например у меня это находится в папке d:\my_twsearch\twsearch

6. Откройте командную строку Windows: нажмите Win + R, введите cmd. Далее работаем с командной строке

7. Перейдите в папку проекта cd d:\my_twsearch\twsearch.

8. Для того чтобы получить исполняемый файл .exe запустите файл compile_for_win64.bat. Полученный файл будет находиться в папке ` /build/win64/twsearch.exe`

9. Для удаления объектных файлов и скомпилированного файла запустите файл clean.bat
